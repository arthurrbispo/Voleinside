<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vôleinside | Questionário</title>
    <link rel="stylesheet" href="./css/estilo.css">
    <link rel="icon" href="./assets/imgs/voleinside/Icon/Logo-_FF5500.ico" />
</head>



<body>
  <div class="header">
    <div class="container">
      <a href="index.html"><img src="./assets/imgs/voleinside/logo-laranja-azul-title.png" class="titulo"></a>
      <ul class="navbar">
        <li>
          <a href="index.html">Inicial</a>
        </li>
        <li>
          <a href="index.html#sobremim">Sobre mim</a>
        </li>
        <li>
          <a href="index.html#ods">ODS</a>
        </li>
        <li>|</li>
        <li>
          <a href="login.html">Login</a>
        </li>
        <li>
          <a href="cadastro.html">Cadastre-se</a>
        </li>
      </ul>
    </div>
  </div>

    <div class="questionario">
        <div class="quest-inputs">
            <div class="quest-title">
                <h2>Preencha os campos e <span>descubra suas estatísticas</span>!</h2>
            </div>
            <div class="quest-input">
                <span>Quando foi o jogo?</span>
                <input type="date" name="" id="iptResposta1">
                <div class="quest-erro" id="divData"></div>
            </div>
            <div class="quest-input">
                <span>Selecione o SET:</span>
                <select name="" id="slctSet">
                    <option value="#">Selecione...</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                </select>
                <div class="quest-erro" id="divSet"></div>
            </div>
            <div class="quest-input">
                <span>Quantos pontos você e sua dupla fizeram?</span>
                <input placeholder="Insira aqui..." type="number" name="" id="iptResposta2">
                <div class="quest-erro" id="divPontosFeitos"></div>
            </div>
            <div class="quest-input">
                <span>Quantos pontos vocês sofreram?</span>
                <input placeholder="Insira aqui..." type="number" name="" id="iptResposta3">
                <div class="quest-erro" id="divPontosSofridos"></div>
            </div>
            <div class="quest-input">
                <span>Quantos pontos <b>você</b> fez?</span>
                <input placeholder="Insira aqui..." type="number" name="" id="iptResposta4">
                <div class="quest-erro" id="divPontosProprios"></div>
            </div>
            <button onclick="validar()">Verificar estatísticas!</button>
            <div id="mensagem_erro"></div>
        </div>

    </div>

  <div class="footer">
    <div class="container">
      <h4>Feito com muito carinho por Arthur Bispo &copy; 2025</h4>
      <span class="version">Todos os direitos reservados &copy; </span>
    </div>
  </div>
<script>
    let axData = 0;
    let axSet = 0;
    let axPontosFeitos = 0;
    let axPontosSofridos = 0;
    let axPontosProprios = 0;



    function validar() {
        axData = iptResposta1.value;
        axSet = slctSet.value;
        axPontosFeitos = iptResposta2.value;
        axPontosSofridos = iptResposta3.value;
        axPontosProprios = iptResposta4.value;
        let validar = false;

        if (axData == "") {
            divData.innerHTML = "Insira uma data válida";
            validar = true;
        } if (axSet == "#") {
            divSet.innerHTML = "Selecione um SET";
            validar = true;
        } if (iptResposta2.value == "" || axPontosFeitos < 0 || axPontosFeitos > 50) {
            divPontosFeitos.innerHTML = "Insira pontos válidos";
            validar = true;
        } if (iptResposta3.value == "" || axPontosSofridos < 0 || axPontosSofridos > 50) {
            divPontosSofridos.innerHTML = "Insira pontos válidos";
            validar = true;
        } if (iptResposta3.value == "" || axPontosProprios < 0 || axPontosProprios > 50 || axPontosProprios > axPontosFeitos) {
            divPontosProprios.innerHTML = "Insira pontos válidos";
            validar = true;
        } if (!validar) {
            iptResposta1.value ="";
            slctSet.value = "#";
            iptResposta2.value = "";
            iptResposta3.value = "";
            iptResposta4.value = "";
            divData.innerHTML = "";
            divSet.innerHTML = ""; 
            divPontosFeitos.innerHTML = "";
            divPontosSofridos.innerHTML = "";
            divPontosProprios.innerHTML = "";
            cadastrar()

        }
    }

    

function cadastrar() {

    var idUsuario = sessionStorage.ID_USUARIO;

    fetch("/questionario/cadastrar", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify({
            idUsuarioServer: idUsuario,
            dataServer: axData,
            setServer: axSet,
            pontosFeitosServer: axPontosFeitos,
            pontosSofridosServer: axPontosSofridos,
            pontosPropriosServer: axPontosProprios
        }),
    })
    .then(function (resposta) {
        console.log("resposta: ", resposta);
        
        if (resposta.ok) {
            document.getElementById("mensagem_erro").innerHTML = 
                "Dados coletados! Redirecionando para a Dashboard...";
            
            setTimeout(() => {
                window.location = "dashboard.html";
            }, 2000);
        } else {
            throw "Houve um erro ao tentar realizar o cadastro!";
        }
    })
    .catch(function (erro) {
        console.log(`#ERRO: ${erro}`);
        document.getElementById("mensagem_erro").innerHTML = 
            "Erro ao cadastrar: " + erro;
    });
}


</script>

</html>




